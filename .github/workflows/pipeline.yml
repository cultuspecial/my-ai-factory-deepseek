name: ğŸ­ AI Research Factory

on:
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©UTCæ—¶é—´2ç‚¹ï¼ˆåŒ—äº¬æ—¶é—´10ç‚¹ï¼‰è‡ªåŠ¨è¿è¡Œ
  workflow_dispatch:       # å…è®¸æ‰‹åŠ¨è§¦å‘

permissions:
  contents: write

jobs:
  run-factory:
    runs-on: ubuntu-latest
    steps:
      # 1. æ‹‰å–ä»£ç 
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      # 2. è®¾ç½®Pythonç¯å¢ƒ
      - name: ğŸ è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. å®‰è£…ç³»ç»Ÿå·¥å…· (jq, bc) å’ŒPythonä¾èµ–
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: |
          sudo apt-get update
          sudo apt-get install -y jq bc  # å®‰è£…çœ‹æ¿è®¡ç®—éœ€è¦çš„å·¥å…·
          pip install -r requirements.txt

      # 4. æ‰§è¡Œæ ¸å¿ƒAIä»»åŠ¡
      - name: ğŸ¤– æ‰§è¡Œæ ¸å¿ƒä»»åŠ¡
        env:
          LLM_API_KEY: ${{ secrets.LLM_API_KEY }}
          LLM_BASE_URL: ${{ secrets.LLM_BASE_URL }}
        run: |
          echo "å¼€å§‹æŠ“å–è®ºæ–‡..."
          python crawler.py
          echo "å¼€å§‹æ€»ç»“è®ºæ–‡..."
          python summarize.py

      # 5. ä¿å­˜è¿è¡Œå†å²
      - name: ğŸ’¾ æäº¤å†å²è®°å½•
        if: always()
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add run_history.jsonl ai_research_report.md
          git commit -m "chore: auto-update report and history [skip ci]" || echo "æ²¡æœ‰æ–°å˜æ›´ï¼Œæ— éœ€æäº¤ã€‚"
          git push

          scripts/generate_summary.py

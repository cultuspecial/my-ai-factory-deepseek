name: ðŸ­ AI Research Factory

on:
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©UTCæ—¶é—´2ç‚¹ï¼ˆåŒ—äº¬æ—¶é—´10ç‚¹ï¼‰è‡ªåŠ¨è¿è¡Œ
  workflow_dispatch:       # å…è®¸æ‰‹åŠ¨è§¦å‘

permissions:
  contents: write

jobs:
  run-factory:
    runs-on: ubuntu-latest
    steps:
      # 1. æ‹‰å–ä»£ç 
      - name: ðŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      # 2. è®¾ç½®PythonçŽ¯å¢ƒ
      - name: ðŸ è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. å®‰è£…ç³»ç»Ÿå·¥å…· (jq, bc) å’ŒPythonä¾èµ–
      - name: ðŸ“¦ å®‰è£…ä¾èµ–
        run: |
          sudo apt-get update
          sudo apt-get install -y jq bc  # å®‰è£…çœ‹æ¿è®¡ç®—éœ€è¦çš„å·¥å…·
          pip install -r requirements.txt

      # 4. æ‰§è¡Œæ ¸å¿ƒAIä»»åŠ¡
      - name: ðŸ¤– æ‰§è¡Œæ ¸å¿ƒä»»åŠ¡
        env:
          LLM_API_KEY: ${{ secrets.LLM_API_KEY }}
          LLM_BASE_URL: ${{ secrets.LLM_BASE_URL }}
        run: |
          echo "å¼€å§‹æŠ“å–è®ºæ–‡..."
          python crawler.py
          echo "å¼€å§‹æ€»ç»“è®ºæ–‡..."
          python summarize.py

      # 5. ä¿å­˜è¿è¡ŒåŽ†å²
      - name: ðŸ“ˆ ç”Ÿæˆè¿è¡Œçœ‹æ¿
        if: always()
        run: python3 scripts/dashboard.py >> $GITHUB_STEP_SUMMARY
